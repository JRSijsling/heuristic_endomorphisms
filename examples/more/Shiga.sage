"""
 *  Treating genus 3 curves by cheating
 *
 *  Copyright (C) 2016  J.R. Sijsling (sijsling@gmail.com)
 *
 *  Distributed under the terms of the GNU General License (GPL)
 *                  http://www.gnu.org/licenses/
 *
 *  This program is free software; you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation; either version 2 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License along
 *  with this program; if not, write to the Free Software Foundation, Inc., 51
 *  Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
"""

# Add if no initilization script set:
load('Initialize.sage')

# To obtain the following matrices, use this Maple code:
#Digits := 100:
#with(algcurves):
#f := y^3 - x*(x - 1)*(x - 1/5)*(x - 4/5):
#f := y^3 - x*(x - 1)*(x - 2/7)*(x - 5/7):
#pm := periodmatrix(f,x,y):
#evalf(pm, 100);

prec = 100
CC = magma.ComplexField(prec)
I = CC.1

P = magma.Matrix(
[
    [-0.2504382720812448983656147603240913549770709447472745673971571207053968432445748794273134516914171588 +
    0.144590603801491480732021616968349979967479364744465269995542085523402574791518009578085694007612079*I ,
    -0.3780289101154113942558595610054437408304185317305781701388859778156625890309854325782476008655943280 +
    0.218255093016593610606480744762533235431408047488628388196175368248146211999456767875096828835933989*I ,
    -0.3780289101154113942558595610054437408304185317305781701388859778156625890309854325782476008655943270 +
    0.0709261145863893508575624891741667245035506820003021517949088027986589375835792512810745591792901687*I ,
    0.1275906380341664958902448006813523858533475869833036027417288571102657457864105531509341491741771702 -
    0.0736644892151021298744591277941832554639286827441631182006332827247436372079387582970111348283219143*I ,
    0.1275906380341664958902448006813523858533475869833036027417288571102657457864105531509341491741771692 -
    0.2155167183878808315895841061425167044710300467447674217904508883220615123750972608591602531869022434*I ,
    0.1228476340470784024753699596427389691237233577639709646554282635951310974581643262763793025172399886 -
    0.2182550930165936106064807447625332354314080474886283881961753682481462119994567678750968288359339893*I],
    [0.02812508727153405132144655586120792377389123446353624478892823962058844095977833717870017485398461650 +
    0.0162380267072019017488481483152491224015957137735017800769084409451536390844071748356479615421166131*I ,
    -0.05842192822967089460122514821844597621998217562172135841389876451932648407958014144952514305303869400 -
    0.0337299159899774875841379514235152674354251409003037126731566610172783363296041527038702681104918614*I ,
    -0.05842192822967089460122514821844597621998217562172135841389876451932648407958014144952514305303869432 +
    0.0662059694043812910818342480540135122386165684473072728269735429075856144984185023751661911947250877*I ,
    0.08654701550120494592267170407965389999387341008525760320282700413991492503935847862822531790702331083 +
    0.0499679426971793893329860997387643898370208546738054927500651019624319754140113275395182296526084742*I ,
    0.08654701550120494592267170407965389999387341008525760320282700413991492503935847862822531790702331035 -
    0.0824439961115831928306823963692626346402122822208090529038819838527392535828256772108141527368417006*I ,
    -0.1146721027727389972441182599408618237677646445487938479917552437605033659991368158069254927610079270 +
    0.0337299159899774875841379514235152674354251409003037126731566610172783363296041527038702681104918617*I],
    [-0.02759384399906816028109545668428009205112291981653176863607563392592673418597643249345109773238744060 +
    0.01593131326083854185169506473421095061701940539197059393582452126684142401812343937001689448870911870*I ,
    -0.1890144550577056971279297805027218704152092658652890850694429889078312945154927162891238004327971633 +
    0.1091275465082968053032403723812666177157040237443141940980876841240731059997283839375484144179669940*I ,
    -0.1890144550577056971279297805027218704152092658652890850694429889078312945154927162891238004327971640 -
    0.0772649199866197215998502429128447164816652129603730062264386415903902579634815051975146254405487588*I ,
    0.1614206110586375368468343238184417783640863460487573164333673549819045603295162837956727027004097237 +
    0.1322597213121705306057176673528004903681964895687045640855229231222077715289373171085722901311298062*I ,
    -0.0338299730244710409565895231370893925107387590654537136916384978716388145431057306447385535262325531 -
    0.0513943705540332172804763093212943128687947463921216698332789226661708928099130650105541740783541981*I ,
    0.0614238170235392012376849798213694845618616788819854823277141317975655487290821631381896512586199927 -
    0.2218555237881112023318718598811946964491445777048382762219807271137928327549995147756003194481608385*I]
])

P = magma.Matrix(
[
    [-0.1378569971262370227625779664550511935515500888235217378201972876728198641701288922379683958713511820 +
    0.0795917744005064105227317339232214541554674470975016171035232060323212842324526318236958209459477572*I ,
    -0.1959746456681324208798451292479472175179021166192427066408328107766395716893869153114695632578412590 +
    0.1131460144308377799318289546633851200475187583718912244464358394075195702710526794805838421433531470*I ,
    -0.1959746456681324208798451292479472175179021166192427066408328107766395716893869153114695632578412595 +
    0.0460375343701750411136345131830577882634161358231120097606105726571229981938525841668077997485423680*I ,
    0.05811764854189539811726716279289602396635202779572096882063552310381970751925802307350116738649007751 -
    0.03355424003033136940909722074016366589205131127438960734291263337519828603860004765688802119740538982*I ,
    0.05811764854189539811726716279289602396635202779572096882063552310381970751925802307350116738649007799 -
    0.1256293087706814516363662471062792424188835829206136268641337786894442824263052159905036206944901254*I ,
    0.07973934858434162464531080366215516958519806102780076899956176456900015665087086916446722848486110399 -
    0.1131460144308377799318289546633851200475187583718912244464358394075195702710526794805838421433531464*I],
    [0.01769776399463229391490299018964874496102621703502523857897903894610901636866129652923468157657496760 +
    0.0102178088063554214754409400830625780001291732203375390384052421714612419861118162875543639657643873*I ,
    -0.02579786381699703853195070063416298471505566946500368622365841433778256090374864733084197592516446980 -
    0.0148944036192605466176260726252106753480475708316874598926186437295340452608898433518342706604233883*I ,
    -0.02579786381699703853195070063416298471505566946500368622365841433778256090374864733084197592516446984 +
    0.0353300212319713895685079527913358313483059172723625379694291280724565292331134759269429985919521627*I ,
    0.04349562781162933244685369082381172967608188650002892480263745328389157727240994386007665750173943744 +
    0.0251122124256159680930670127082732533481767440520249989310238859009952872470016596393886346261877755*I ,
    0.04349562781162933244685369082381172967608188650002892480263745328389157727240994386007665750173943739 -
    0.0455478300383268110439488928743984093484350904927000770078343702439177712192252922144973625577165499*I ,
    -0.06119339180626162636175668101346047463710810353505416338161649223000059364107124038931133907831440504 +
    0.0148944036192605466176260726252106753480475708316874598926186437295340452608898433518342706604233882*I],
    [-0.02300041800687498800638850055963655025946298218559951442898819567432424167450502054118492958183979240 +
    0.01327929752774319002344383614905073219149807069568091943306425368662115332765668377622622012565904919*I ,
    -0.09798732283406621043992256462397360875895105830962135332041640538831978584469345765573478162892062990 +
    0.05657300721541888996591447733169256002375937918594561222321791970375978513552633974029192107167657400*I ,
    -0.09798732283406621043992256462397360875895105830962135332041640538831978584469345765573478162892063001 -
    0.03001441215993250991902680503359109564076323779458377335708941233051747848021297218783948082035847544*I ,
    0.07498690482719122243353406406433705849948807612402183889142820971399554417018843711454985204708083652 +
    0.06277264900236436100921748206759815171268130292201486368463573130101932334640887257842106044324179353*I ,
    -0.01686925628529582431626690127144103453313604832830087007079268661017583665093041404104868466059075880 -
    0.03629806471283071058026109274057962632320613860723692431336954001518265242458297585963011999993023346*I ,
    0.03986967429217081232265540183107758479259903051390038449978088228450007832543543458223361424243055218 -
    0.1096061865604389204417585389568125497962306848920853904606126183628387627126656040115353017663062324*I]
])

P = magma.Transpose(P)
g = 0
End = EndomorphismData(g, prec = prec)
End._P_ = P

AsAlg, As, Rs = End.geometric_representations()
print AsAlg
print Rs
print magma.SplittingInfoOneOff(AsAlg, As, Rs)

K = magma.BaseRing(AsAlg[1])
G = magma.GaloisGroup(K)
print K
print G
print magma.IsCyclic(G)

idem = (AsAlg[2] - 1)/2
idem = magma.Matrix(magma.BaseRing(P), 3, 3, magma.Eltseq(idem))
Q = magma.LatticesFromIdempotentG1(idem, P)
print Q

idem = (AsAlg[2] + 1)/2
idem = magma.Matrix(magma.BaseRing(P), 3, 3, magma.Eltseq(idem))
Q = magma.LatticesFromIdempotentG2(idem, P)
print Q

# Analyze factor:
Q = magma.Matrix(magma.BaseRing(P), 4, 2, Q) 
g = 0
End = EndomorphismData(g, prec = prec)
End._P_ = Q

AsAlg, As, Rs = End.geometric_representations()
print AsAlg
print Rs
print magma.SplittingInfoOneOff(AsAlg, As, Rs)

K = magma.BaseRing(AsAlg[1])
G = magma.GaloisGroup(K)
print K
print G
print magma.IsCyclic(G)

