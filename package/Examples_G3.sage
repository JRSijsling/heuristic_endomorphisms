"""
 *  Treating genus 3 curves by cheating
 *
 *  Copyright (C) 2016  J.R. Sijsling (sijsling@gmail.com)
 *
 *  Distributed under the terms of the GNU General License (GPL)
 *                  http://www.gnu.org/licenses/
 *
 *  This program is free software; you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation; either version 2 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License along
 *  with this program; if not, write to the Free Software Foundation, Inc., 51
 *  Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
"""

# Add if no initilization script set:
load('Initialize.sage')

# To obtain the following matrices, use this Maple code:
#Digits := 100:
#with(algcurves):
#f := y^3 - x^4 - x^2 - 1:
#f := x^4 + 8*x^3*1 + 2*x^2*y*1 + 25*x^2*1^2 - x*y^3 + 2*x*y^2*1 + 8*x*y*1^2 + 36*x*1^3 + y^4 - 2*y^3*1 + 5*y^2*1^2 + 9*y*1^3 + 20*1^4:
#pm := periodmatrix(f,x,y):
#evalf(pm, 100);

prec = 100
CC = magma.ComplexField(prec)
I = CC.1

P = magma.Matrix(
[
[1.134803188672312495958997095518625121773662233708117045195687474471598448204389367801693974966143368 +
0.655178926457205294613395448383109293820699555666687171973623387273581675781031842354884854550813697*I ,
1.443035550619606019725504093506357954719691587853018502632683227023212735171150749674848294985999088,
1.856320963982115505821749142271804099133508027634626296512029087983204815789964742639118122459142907 +
0.594526518943438762880598076969222413388186637007333140499906336219622825272632576680173553558894955*I ,
-1.443035550619606019725504093506357954719691587853018502632683227023212735171150749674848294985999078,
-0.721517775309803009862752046753178977359845793926509251316341613511606367585575374837424147492999544 +
0.060652407513766531732797371413886880432512918659354031473717051053958850508399265674711300991918745*I ,
-0.413285413362509486096245048765446144413816439781607793879345860959992080618813992964269827473143829 +
0.5945265189434387628805980769692224133881866370073331404999063362196228252726325766801735535588949550*I],
[0.682319183976174766324958975409193568786879222162546696709634338430359490641519124284164506267360778 -
0.393937164541890287829467884162914242862166776378667309925264812857841626510252321453473129270790009*I ,
-1.133386679254062992090179826170562559719344135648094849153688120753667339237093083106513452386485462,
0.115625844349143270279869062323912288927207154338499272132790278053525821022972582730907780074118047 +
1.375478821086794242875838812347729067491252804872217620264038334810437083354594246707149689540001727*I ,
1.133386679254062992090179826170562559719344135648094849153688120753667339237093083106513452386485462,
0.566693339627031496045089913085281279859672067824047424576844060376833669618546541553256726193242733 -
1.769415985628684530705306696510643310353419581250884930189303147668278709864846568160622818810791736*I ,
-1.249012523603206262370048888494474848646551289986594121286478398807193160260065665837421232460603510 +
1.375478821086794242875838812347729067491252804872217620264038334810437083354594246707149689540001727*I],
[0.636983494621901784641039487225435548918801822776654682337034601298411045488944956681897546438373876 -
1.103287776267910592404414808764092976528379922937855445400071134013121572428383162131545363935886701*I ,
1.273966989243803569282078974450871097837603645553309364674069202596822090977889913363795092876747742,
0,
1.273966989243803569282078974450871097837603645553309364674069202596822090977889913363795092876747760,
-0.636983494621901784641039487225435548918801822776654682337034601298411045488944956681897546438373871 +
1.103287776267910592404414808764092976528379922937855445400071134013121572428383162131545363935886701*I ,
-1.273966989243803569282078974450871097837603645553309364674069202596822090977889913363795092876747756]
]);

P = magma.Matrix(
[
[-0.709405978948882417234094721439074016050485919299713347547776304110103967580287564105482610071750744 +
1.169996081013777801655761441037447933223924870557277901581121009335540645594339598982252112510221578*I ,
-0.2184818094134879958287533260830886451837304288991843035100312374418111819792939385123159355838819400 -
0.9382640081087230752955574706108798519148236069477509333346567037070036445088087581018469977631811578*I ,
0.666132977090991180915258233279987136394476005467897191224309534707545279082931685501471980319142316 -
1.355830774872619095562773974981725372709109305465450831258712246041713718531246911533957674109547782*I ,
-0.884614786504479176744011559363075781578206434367081494734340772149356461062225624013787915903024243 -
0.4175667667638960202672165043708455207942856985176998979240555423347100740224381534321106763463666241*I ,
1.933750831714027919568941701619432127840848665031186855961030189955853682461339437971356964069825549 -
0.3348625474859857611213284322957568916353534735218781057330099246661204975494632921180307598174883298*I ,
-0.3936906169690847553386701640070904107114509439665524506965957054810636754612319984206212414151554870 +
1.690693322358604856684102407277482264344462778987328936991722170707834216080710203651988433927036112*I]
,
[0.1795490112102236658891670102970032576924189560471400447281208243283284682162929753363539167972469600 +
0.898241090325715249671754499123739389866462781999085706543715020968094592907930709003761239178333608*I ,
0.906528115993383043368717631588359400908854842640131960979194775986521222614775734420015896324744279 +
0.498486197651282600767879590549712453624454567525277197440380769621074139540712718404425950655295940*I ,
1.230064254719530997139988690966936453077211024669368870979886220753001063726123079321926972282992929 -
0.1231159235545407363813184059791072085224357707694861456342233975011596208001890838989900413696015362*I ,
-0.3235361387261479537712710593785770521683561820292369100006914447664798411113473449019110759582486480 -
0.621602121205823337149197996528819662146890338294763343074604167122233760340901802303415992024897472*I ,
-2.799491175311012600043161397299280241606288050454913979187275390084796740020115272539887516585232862 +
0.344963152085931424626641493933899934427317894590440979605493313276372927773872895603070744871461336*I ,
0.403442966057011423708279561912779091048079704563755006250382506891712913287135414181750903569248673 -
0.221847228531390688245323087954792725904882123820954833971269915775213306973683811704080703501859804*I]
,
[2.825716293400112291152429235451985131512171153471493486365880450597625696108686474551817567236502259 -
2.138033461992526862846206302122719093419639982798829398447787835096246615922273231385229239342765338*I ,
1.341749610468900937462010640892619372215704605510680187717003042825543156755647684557190240261007335 +
2.330325095989449830903074600520247999798635364385368759529817717853923268046893343693166224510904949*I ,
0.198651370906283106471899210581364619823979354045364941762808157322665074129856498424082345910206776 +
3.983172711956453748211193377989223442357960618279592426869335511482774634102928868769324713533492606*I ,
1.143098239562617830990111430311254752391725251465315245954194885502878082625791186133107894350800461 +
1.652847615967003917308118777468975442559325253894223667339517793628851366056035525076158489022587668*I ,
-4.827478627600727120675836188741001862134097771501857756410521491710303096165486635943159182509128021 -
1.167661769941480971770031252815231791699010524989617936231247752161456116189797818767087738702409988*I ,
-0.340868443368593522700307164248111006904741296495498052694682522269204456727247603861519432624694435 -
2.815510942014972776441162125173991650658950093289974490638087759321318517913131050002236974831082619*I]
]);

g = 0
End = EndomorphismData(g, prec = prec)
End._P_ = magma.Transpose(P)

AsAlg, As, Rs = End.geometric_representations()
print AsAlg
print Rs
print magma.SplittingInfoOneOff(AsAlg, As, Rs)

dim = len(AsAlg)
B = 1
D = [-B..B]
CP = cartesian_product([ D for i in range(dim) ])
deg_min = 10^6
for tup in CP:
    print tup
    R = sum([ tup[i]*Rs[i+1] for i in range(dim) ])
    A = sum([ tup[i]*AsAlg[i+1] for i in range(dim) ])
    p = magma.MinimalPolynomial(R)
    deg = End.degree_estimate(A)
    if magma.Degree(p) == dim:
        if deg < deg_min:
            deg_min = deg
            R_min = R
            A_min = A
print deg_min
print R_min
print A_min
print magma.Parent(A_min[1,1])

#[   -r^2 + r + 1               0 2*r^2 - 4*r - 2]
#[              0         r^2 - 2               0]
#[              0               0              -r]
#Number Field with defining polynomial x^3 - x^2 - 2*x + 1 over the Rational Field

